-- Database Creation
CREATE DATABASE IF NOT EXISTS healthy_food_app;
USE healthy_food_app;

-- Table Structures

CREATE TABLE `api_logs` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `user_id` int(11) DEFAULT NULL,
 `endpoint` varchar(100) DEFAULT NULL,
 `query` varchar(255) DEFAULT NULL,
 `status` int(11) DEFAULT NULL,
 `response_time` float DEFAULT NULL,
 `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
 PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=34 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `favorites` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `user_id` int(11) NOT NULL,
 `food_id` int(11) NOT NULL,
 `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
 PRIMARY KEY (`id`),
 UNIQUE KEY `ux_user_food` (`user_id`,`food_id`),
 KEY `fk_fav_food` (`food_id`),
 CONSTRAINT `fk_fav_food` FOREIGN KEY (`food_id`) REFERENCES `foods` (`id`) ON DELETE CASCADE,
 CONSTRAINT `fk_fav_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `foods` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `name` varchar(255) NOT NULL,
 `description` text DEFAULT NULL,
 `calories` int(11) DEFAULT 0,
 `protein` double DEFAULT 0,
 `carbs` double DEFAULT 0,
 `fat` double DEFAULT 0,
 `image_path` varchar(255) DEFAULT NULL,
 `is_verified` tinyint(1) DEFAULT 0,
 `category_id` int(11) DEFAULT NULL,
 `created_by` int(11) DEFAULT NULL,
 `is_favorite` tinyint(1) NOT NULL DEFAULT 0,
 `category` enum('breakfast','main','snack','side') DEFAULT 'main',
 PRIMARY KEY (`id`),
 KEY `created_by` (`created_by`),
 CONSTRAINT `foods_ibfk_1` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=59 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `food_categories` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `name` varchar(100) NOT NULL,
 `slug` varchar(100) DEFAULT NULL,
 `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
 PRIMARY KEY (`id`),
 UNIQUE KEY `slug` (`slug`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `meal_plans` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `user_id` int(11) NOT NULL,
 `plan_date` date NOT NULL,
 `meal_type` enum('breakfast','lunch','dinner','snack') NOT NULL,
 `food_id` int(11) NOT NULL,
 `servings` float DEFAULT 1,
 `notes` varchar(500) DEFAULT NULL,
 `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
 PRIMARY KEY (`id`),
 KEY `fk_plan_user` (`user_id`),
 KEY `fk_plan_food` (`food_id`),
 CONSTRAINT `fk_plan_food` FOREIGN KEY (`food_id`) REFERENCES `foods` (`id`) ON DELETE CASCADE,
 CONSTRAINT `fk_plan_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=137 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `notifications` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `user_id` int(11) NOT NULL,
 `title` varchar(255) DEFAULT NULL,
 `message` text DEFAULT NULL,
 `status` enum('sent','failed') DEFAULT 'sent',
 `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
 PRIMARY KEY (`id`),
 KEY `user_id` (`user_id`),
 CONSTRAINT `notifications_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `nutrition_logs` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `user_id` int(11) NOT NULL,
 `food_id` int(11) DEFAULT NULL,
 `food_name` varchar(255) NOT NULL,
 `calories` int(11) NOT NULL DEFAULT 0,
 `protein` float DEFAULT 0,
 `carbs` float DEFAULT 0,
 `fat` float DEFAULT 0,
 `date` date NOT NULL,
 PRIMARY KEY (`id`),
 KEY `fk_logs_user` (`user_id`),
 KEY `fk_logs_food` (`food_id`),
 CONSTRAINT `fk_logs_food` FOREIGN KEY (`food_id`) REFERENCES `foods` (`id`) ON DELETE CASCADE,
 CONSTRAINT `fk_logs_user` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=286 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `settings` (
 `setting_key` varchar(50) NOT NULL,
 `setting_value` text DEFAULT NULL,
 `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
 PRIMARY KEY (`setting_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `users` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `name` varchar(100) NOT NULL,
 `email` varchar(100) NOT NULL,
 `password` varchar(255) NOT NULL,
 `role` enum('admin','user') DEFAULT 'user',
 `reset_token` varchar(64) DEFAULT NULL,
 `reset_expires_at` datetime DEFAULT NULL,
 `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
 `goal` enum('diet','maintain','muscle') DEFAULT 'maintain',
 `gender` enum('male','female') DEFAULT 'male',
 `age` int(11) DEFAULT 25,
 `height` int(11) DEFAULT 170,
 `activity_level` enum('sedentary','light','moderate','active','athlete') DEFAULT 'moderate',
 PRIMARY KEY (`id`),
 UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB AUTO_INCREMENT=30 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

CREATE TABLE `weight_logs` (
 `id` int(11) NOT NULL AUTO_INCREMENT,
 `user_id` int(11) NOT NULL,
 `weight` decimal(5,2) NOT NULL,
 `date` date NOT NULL,
 `notes` varchar(255) DEFAULT NULL,
 `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
 PRIMARY KEY (`id`),
 KEY `idx_user_date` (`user_id`,`date`),
 CONSTRAINT `weight_logs_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=30 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
