=====================================================
          SMART HEALTHY - PROJECT DOCUMENTATION
=====================================================

This file contains the consolidated technical notes for the project, including:
1. System Diagrams (Mermaid Format)
2. Key SQL Queries
3. Database Structure

-----------------------------------------------------
SECTION 1: SYSTEM DIAGRAMS
-----------------------------------------------------

[1.1] CLASS DIAGRAM (Mermaid Code)
----------------------------------
classDiagram
    class Database {
        +Connection conn
    }

    class User {
        -Database db
        +findByEmail(email)
        +findById(id)
    }

    class NutritionLog {
        -Database db
        +addLog(userId, food, calories)
        +getWeekly(userId)
    }

    class Food {
        +int id
        +string name
        +int calories
        +float protein
        +float carbs
        +float fat
    }

    class AuthService {
        -Database db
        +register(name, email, password)
        +login(email, password)
    }

    class MealRecommendationService {
        -Database db
        +calculateDailyCalories(userId)
        +generateDailyPlan(userId, date)
        -getRandomFood(mealType)
    }

    class AnalyticsService {
        -Database db
        +getWeeklyTotals(userId)
        +getTopFoods(userId, limit)
        +getHistory(userId, limit)
    }

    class NutritionApiClient {
        -string appId
        -string appKey
        +fetchNutrition(input)
        -autoFormat(input)
    }

    %% Relationships
    AuthService ..> User : Creates/Verifies
    Service <|-- AuthService
    Service <|-- MealRecommendationService
    Service <|-- AnalyticsService
    
    MealRecommendationService --> Database : Queries User/Foods/MealPlans
    AnalyticsService --> Database : Queries NutritionLogs
    AuthService --> Database : Usage
    User --> Database : Usage
    NutritionLog --> Database : Usage
    
    MealRecommendationService ..> Food : Selects


[1.2] ACTIVITY DIAGRAM: DAILY MEAL RECOMMENDATION
-------------------------------------------------
stateDiagram-v2
    [*] --> Login
    
    state "User Actions" as User {
        Login --> Dashboard
        Dashboard --> RequestRecommendation : Click "Generate Plan"
        ViewPlan --> [*]
    }
    
    state "System Logic (Services)" as System {
        RequestRecommendation --> CalculateTDEE : MealRecommendationService
        CalculateTDEE --> FetchUserProfile : Get Weight/Height/Goal
        FetchUserProfile --> CalculateBMR : Mifflin-St Jeor
        CalculateBMR --> ApplyActivityMultiplier
        ApplyActivityMultiplier --> AdjustForGoal : Diet/Muscle/Maintain
        
        AdjustForGoal --> GeneratePlan
        GeneratePlan --> SelectBreakfast
        GeneratePlan --> SelectLunch
        GeneratePlan --> SelectDinner
        GeneratePlan --> SelectSnack
        
        SelectBreakfast --> CheckDatabase : Get Random Food (Balanced)
        SelectLunch --> CheckDatabase
        SelectDinner --> CheckDatabase
        SelectSnack --> CheckDatabase
        
        CheckDatabase --> CalculatePortions : Based on Calorie Target
        CalculatePortions --> SaveToDB : Insert into meal_plans
        SaveToDB --> ViewPlan : Return Success
    }
    
    state "Database" as DB {
        FetchUserProfile --> UsersTable : Select
        CheckDatabase --> FoodsTable : Select Random
        SaveToDB --> MealPlansTable : Insert
    }


[1.3] ACTIVITY DIAGRAM: NUTRITION LOGGING
-----------------------------------------
stateDiagram-v2
    [*] --> SearchFood
    
    state "User UI" as UI {
        SearchFood --> InputQuery : Type "Nasi Goreng"
        InputQuery --> SubmitSearch
        DisplayResults --> AddToLog : Click "Add"
    }
    
    state "NutritionApiClient" as API {
        SubmitSearch --> AutoFormat : Process Input
        AutoFormat --> CallEdamam : POST /nutrition-details
        CallEdamam --> ParseResponse : JSON Result
        ParseResponse --> DisplayResults : Return Data
    }
    
    state "AnalyticsService" as Analytics {
        AddToLog --> SaveLog : Insert DB
    }
    
    SaveLog --> [*]


[1.4] USE CASE DIAGRAM
----------------------
usecaseDiagram
    actor "User (Member)" as U
    actor "Admin" as A

    package "Authentication" {
        usecase "Register" as UC1
        usecase "Login" as UC2
        usecase "Logout" as UC3
        usecase "Manage Profile" as UC4
    }

    package "Core Features" {
        usecase "Generate Meal Recommendation" as UC5
        usecase "Search Nutrition Info" as UC6
        usecase "Log Daily Meals" as UC7
        usecase "View Analytics / Progress" as UC8
        usecase "View Dashboard" as UC9
    }

    package "Admin Panel" {
        usecase "Manage Foods (CRUD)" as UC10
        usecase "Manage Users" as UC11
        usecase "View API Logs" as UC12
        usecase "View System Reports" as UC13
        usecase "Manage Settings" as UC14
    }

    U --> UC1
    U --> UC2
    U --> UC3
    U --> UC4
    U --> UC5
    U --> UC6
    U --> UC7
    U --> UC8
    U --> UC9

    A --> UC2
    A --> UC3
    A --> UC9
    A --> UC10
    A --> UC11
    A --> UC12
    A --> UC13
    A --> UC14


-----------------------------------------------------
SECTION 2: KEY SQL QUERIES
-----------------------------------------------------

[2.1] Authentication & User Management
--------------------------------------
Login:
SELECT * FROM users WHERE email=?

Register:
INSERT INTO users (name, email, password, role) VALUES (?, ?, ?, 'user')

Find User (by ID):
SELECT * FROM users WHERE id = ?

Get Profile for TDEE Calculation:
SELECT gender, age, height, activity_level, goal FROM users WHERE id = ?

List All Users (Admin):
SELECT * FROM users ORDER BY created_at DESC

Add User (Admin):
INSERT INTO users (name, email, password, role) VALUES (?, ?, ?, ?)


[2.2] Food & Nutrition Database
-------------------------------
List All Foods:
SELECT * FROM foods ORDER BY id DESC

Insert Food Item:
INSERT INTO foods (name, description, calories, protein, carbs, fat, created_by) VALUES ...

Update Food Item:
UPDATE foods SET name=?, description=?, calories=?, protein=?, carbs=?, fat=? WHERE id=?

Delete Food Item:
DELETE FROM foods WHERE id=?

List Categories:
SELECT * FROM food_categories ORDER BY name ASC


[2.3] Meal Recommendation System
--------------------------------
Get Latest Weight:
SELECT weight FROM weight_logs WHERE user_id = ? ORDER BY date DESC, created_at DESC LIMIT 1

Select Balanced Food (Algorithm):
SELECT id, name, calories, protein, carbs, fat 
FROM foods 
WHERE category = ? 
AND (protein / (protein + carbs + fat)) > 0.15
AND (fat / (protein + carbs + fat)) < 0.40
AND (carbs / (protein + carbs + fat)) < 0.65
ORDER BY RAND() LIMIT 1

Insert System Generated Plan:
INSERT INTO meal_plans (user_id, plan_date, meal_type, food_id, servings, notes) VALUES (?, ?, ?, ?, ?, ?)


[2.4] Analytics & Statistics
----------------------------
Get Weekly Totals (Calories/Macros):
SELECT date, SUM(calories) AS cal, SUM(protein) AS p, SUM(carbs) AS c, SUM(fat) AS f FROM nutrition_logs WHERE user_id = ? GROUP BY date ORDER BY date ASC

Get Top Frequent Foods:
SELECT food_name, COUNT(*) AS total FROM nutrition_logs WHERE user_id = ? GROUP BY food_name ORDER BY total DESC LIMIT ?

Get Average Macros (Last 7 Days):
SELECT AVG(calories) AS avg_cal, AVG(protein) AS avg_p, ... FROM nutrition_logs WHERE user_id = ? AND date >= DATE_SUB(CURDATE(), INTERVAL 6 DAY)

API Usage Trend (Admin):
SELECT query, COUNT(*) as c FROM api_logs WHERE DATE(created_at) = '$today' GROUP BY query ORDER BY c DESC LIMIT 1


[2.5] Daily Logging
-------------------
Insert Nutrition Log:
INSERT INTO nutrition_logs (user_id, food_name, calories, date) VALUES (?, ?, ?, CURDATE())

Get Daily Plan Details:
SELECT food_name, calories, protein, carbs, fat FROM nutrition_logs WHERE user_id = ? AND date = ?

[2.6] System & Settings
-----------------------
View API Logs Count:
SELECT COUNT(*) as c FROM api_logs

Update System Settings (Upsert):
INSERT INTO settings (setting_key, setting_value) VALUES (?, ?) ON DUPLICATE KEY UPDATE setting_value = VALUES(setting_value)


-----------------------------------------------------
SECTION 3: DATABASE STRUCTURE
-----------------------------------------------------

[3.1] USERS & PROFILE
---------------------
- `users`: Menyimpan data akun pengguna (email, password, role) serta profil fisik (berat, tinggi, umur, aktivitas, goal) untuk keperluan perhitungan nutrisi.
- `weight_logs`: Menyimpan riwayat perubahan berat badan pengguna dari waktu ke waktu.
- `favorites`: Menyimpan referensi makanan yang difavoritkan oleh pengguna.

[3.2] FOOD MANAGEMENT
---------------------
- `foods`: Tabel utama untuk menyimpan database makanan beserta informasi nutriennya (kalori, protein, lemak, karbohidrat).
- `food_categories`: Mengelompokkan jenis makanan (misal: Main Course, Snack, Breakfast).

[3.3] DAILY TRACKING & PLAN
---------------------------
- `nutrition_logs`: Paling sering digunakan. Menyimpan jurnal harian apa yang dimakan pengguna pada tanggal tertentu.
- `meal_plans`: Menyimpan rencana makan (Meal Plan) yang digenerate oleh sistem atau dibuat oleh user.

[3.4] SYSTEM & UTILITIES
------------------------
- `api_logs`: Digunakan untuk memantau performa dan penggunaan API eksternal (seperti Edamam).
- `notifications`: Menyimpan antrean pesan notifikasi/email yang akan dikirim ke pengguna.
- `settings`: Menyimpan konfigurasi dinamis aplikasi yang bisa diatur oleh admin.
